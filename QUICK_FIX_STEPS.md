# ๐ง ุฎุทูุงุช ุงูุฅุตูุงุญ ุงูุณุฑูุน - ุฎุทุฃ RLS

## โ ุงูุฎุทุฃ:
```
PostgrestException: new row violates row-level security policy for table "products"
```

---

## โ ุงูุญู ุงูุณุฑูุน (3 ุฎุทูุงุช):

### ุงูุฎุทูุฉ 1: ุชุดุบูู ููู ุงูุฅุตูุงุญ

1. ุงูุชุญ **Supabase Dashboard**
2. ุงุฐูุจ ุฅูู **SQL Editor**
3. ุงูุณุฎ ูุญุชูู ููู **`fix_rls_complete.sql`**
4. ุงูุตูู ูู SQL Editor
5. ุงุถุบุท **Run**

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงููุณุชุฎุฏู ุงูุฃุฏูู

ุจุนุฏ ุชุดุบูู ุงูุฅุตูุงุญุ ุดุบูู ูุฐุง ุงูุงุณุชุนูุงู:

```sql
SELECT 
  u.id,
  u.email,
  pu.name,
  pu.is_admin
FROM auth.users u
LEFT JOIN public.users pu ON u.id = pu.id
WHERE u.email = 'aliabouali2005@gmail.com';
```

**ูุฌุจ ุฃู ุชุฑู:**
- `is_admin = TRUE` โ

**ุฅุฐุง ูุงู `is_admin = NULL` ุฃู `FALSE`:**

ุดุบูู ูุฐุง:
```sql
UPDATE public.users 
SET is_admin = TRUE 
WHERE id = (SELECT id FROM auth.users WHERE email = 'aliabouali2005@gmail.com');
```

### ุงูุฎุทูุฉ 3: ุฅุนุงุฏุฉ ุชุณุฌูู ุงูุฏุฎูู

1. **ุฃุบูู ุงูุชุทุจูู ุชูุงูุงู**
2. **ุงูุชุญู ูุฑุฉ ุฃุฎุฑู**
3. **ุณุฌู ุฏุฎูู ุจุญุณุงุจ ุงูุฃุฏูู:**
   - Email: `aliabouali2005@gmail.com`
   - Password: `aliassi20`
4. **ุญุงูู ุฅุถุงูุฉ ููุชุฌ ูุฑุฉ ุฃุฎุฑู**

---

## ๐ ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:

### ุงูุญู ุงูุจุฏูู 1: ุชุนุทูู RLS ูุคูุชุงู (ููุงุฎุชุจุงุฑ ููุท)

โ๏ธ **ุชุญุฐูุฑ:** ูุฐุง ููุท ููุงุฎุชุจุงุฑ! ูุง ุชุณุชุฎุฏูู ูู ุงูุฅูุชุงุฌ.

```sql
-- ุชุนุทูู RLS ูุคูุชุงู
ALTER TABLE public.products DISABLE ROW LEVEL SECURITY;

-- ุจุนุฏ ุงูุงุฎุชุจุงุฑุ ุฃุนุฏ ุชูุนููู:
-- ALTER TABLE public.products ENABLE ROW LEVEL SECURITY;
```

### ุงูุญู ุงูุจุฏูู 2: ุฅูุดุงุก ุณุฌู ุงููุณุชุฎุฏู ูุฏููุงู

```sql
-- ุงุญุตู ุนูู ID ุงููุณุชุฎุฏู
SELECT id, email FROM auth.users WHERE email = 'aliabouali2005@gmail.com';

-- ุซู ุฃูุดุฆ ุงูุณุฌู (ุงุณุชุจุฏู 'USER_ID_HERE' ุจู ID ุงููุนูู)
INSERT INTO public.users (id, name, is_admin)
VALUES (
  'USER_ID_HERE',  -- ุงุณุชุจุฏู ูุฐุง ุจู ID ุงููุนูู
  'Admin User',
  TRUE
)
ON CONFLICT (id) DO UPDATE SET is_admin = TRUE;
```

---

## โ ุงูุชุญูู ุงูููุงุฆู:

ุจุนุฏ ูู ุงูุฎุทูุงุชุ ุงุฎุชุจุฑ:

1. **ุชุญูู ูู Function:**
```sql
SELECT public.is_admin();
```
ูุฌุจ ุฃู ูุนุทู `true` ุฅุฐุง ููุช ูุณุฌู ุฏุฎูู ูุฃุฏูู

2. **ุชุญูู ูู Policies:**
```sql
SELECT * FROM pg_policies WHERE tablename = 'products';
```
ูุฌุจ ุฃู ุชุฑู 4 policies

3. **ุฌุฑุจ ุฅุถุงูุฉ ููุชุฌ ูู ุงูุชุทุจูู**

---

## ๐ ุฅุฐุง ูู ูุนูู:

1. ุชุญูู ูู **Supabase Logs** ููุฃุฎุทุงุก
2. ุชุฃูุฏ ูู ุฃูู **ูุณุฌู ุฏุฎูู** ูู ุงูุชุทุจูู
3. ุชุฃูุฏ ูู ุฃู **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู** ุตุญูุญ
4. ุฌุฑุจ **ุญุฐู ูุฅุนุงุฏุฉ ุชุซุจูุช ุงูุชุทุจูู**

---

## ๐ฏ ุงููููุงุช ุงููุทููุจุฉ:

- โ `fix_rls_complete.sql` - ููู ุงูุฅุตูุงุญ ุงููุงูู

---

## โจ ุจุนุฏ ุงูุฅุตูุงุญ:

- โ ููููู ุฅุถุงูุฉ ููุชุฌุงุช ูู Admin Dashboard
- โ ููููู ุชุนุฏูู ุงูููุชุฌุงุช
- โ ููููู ุญุฐู ุงูููุชุฌุงุช
- โ Real-time updates ุชุนูู

